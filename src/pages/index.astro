---
const siteTitle = "هوشینو — اولین پایگاه خبری مبتنی بر هوش مصنوعی";
---
<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>{siteTitle}</title>
    <meta name="description" content="{siteTitle} | گردآوری، ترجمه و دسته‌بندی خودکار خبرها از منابع معتبر خارجی.">
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <div class="container">
        <div class="top">
          <div class="brand">
            <div class="logo">🧠</div>
            <div>
              <h1>{siteTitle}</h1>
              <p class="sub">گردآوری، ترجمه و دسته‌بندی خودکار خبرها از منابع معتبر خارجی</p>
            </div>
          </div>
          <div class="actions">
            <span class="live"><span class="dot"></span> زنده</span>
          </div>
        </div>
        <div class="row">
          <div class="filters" id="filters">
            <button class="chip active" data-cat="all">همه</button>
            <button class="chip" data-cat="world">جهان</button>
            <button class="chip" data-cat="business">اقتصاد</button>
            <button class="chip" data-cat="science">علم</button>
            <button class="chip" data-cat="tech">تکنولوژی</button>
            <button class="chip" id="btn-refresh">بروزرسانی</button>
          </div>
          <input class="search" id="search" placeholder="جستجو در عنوان/خلاصه...">
        </div>
      </div>
      <div class="ticker-wrap" aria-label="نوار تیترهای زنده">
        <div class="container" style="padding-top:0;padding-bottom:0">
          <div class="ticker">
            <span class="ticker-label">خبرهای جدید</span>
            <div class="ticker-track marqA" id="tickerA"></div>
            <div class="ticker-track marqB" id="tickerB" aria-hidden="true"></div>
          </div>
        </div>
      </div>
    </header>

    <main class="container">
      <div class="grid" id="grid"></div>
      <div id="empty" class="empty" style="display:none;">موردی یافت نشد.</div>
    </main>

    <div class="modal" id="modal">
      <div class="sheet">
        <div class="sheet-head">
          <strong>خلاصه خبر</strong>
          <button class="close" id="btn-close">بستن</button>
        </div>
        <div class="sheet-body">
          <h3 class="sheet-title" id="m-title"></h3>
          <div class="sheet-meta">
            <span id="m-source"></span>
            <span id="m-time"></span>
            <span id="m-cat"></span>
          </div>
          <p id="m-summary"></p>
          <p style="margin-top:10px"><a id="m-link" href="#" target="_blank" rel="noopener" class="link">مشاهده در منبع</a></p>
        </div>
      </div>
    </div>

    <footer style="text-align:center;opacity:.7;padding:24px 0;font-size:12px">© {siteTitle}</footer>

    <script type="module">
      const $grid=document.getElementById('grid');
      const $filters=document.getElementById('filters');
      const $search=document.getElementById('search');
      const $empty=document.getElementById('empty');
      const $btn=document.getElementById('btn-refresh');
      const $tickerA=document.getElementById('tickerA');
      const $tickerB=document.getElementById('tickerB');

      const $modal=document.getElementById('modal');
      const $mTitle=document.getElementById('m-title');
      const $mSource=document.getElementById('m-source');
      const $mTime=document.getElementById('m-time');
      const $mCat=document.getElementById('m-cat');
      const $mSummary=document.getElementById('m-summary');
      const $mLink=document.getElementById('m-link');
      const $btnClose=document.getElementById('btn-close');

      function timeAgo(iso){
        const ts=new Date(iso).getTime();
        const diff=Math.floor((Date.now()-ts)/1000);
        if(diff<60)return'همین الان';
        const m=Math.floor(diff/60); if(m<60)return m+' دقیقه پیش';
        const h=Math.floor(m/60); if(h<24) return h+' ساعت پیش';
        const d=Math.floor(h/24); return d+' روز پیش';
      }

      function openModal(item){
        $mTitle.textContent = item.titleFa || item.title;
        $mSource.textContent = 'منبع: ' + (item.source||'منبع');
        $mTime.textContent = timeAgo(item.publishedAt);
        $mCat.textContent = 'دسته: ' + (item.category || 'عمومی');
        $mSummary.textContent = item.summaryFa || item.summary || '—';
        $mLink.href = item.url;
        $modal.style.display = 'flex';
      }
      function closeModal(){ $modal.style.display='none'; }
      $btnClose.addEventListener('click', closeModal);
      $modal.addEventListener('click', (e)=>{ if(e.target===$modal) closeModal(); });

      function render(items){
        let list = items.slice();
        const active = $filters.querySelector('.chip[data-cat].active')?.getAttribute('data-cat') || 'all';
        const q = ($search.value||'').trim();
        if (active !== 'all') list = list.filter(i=>i.category===active);
        if (q) list = list.filter(i => (i.titleFa||'').includes(q) || (i.summaryFa||'').includes(q));

        list.sort((a,b)=> new Date(b.publishedAt) - new Date(a.publishedAt));

        $grid.innerHTML = list.map(i => `
          <article class="card" data-id="${i.id}" data-url="${i.url}">
            <div class="thumb">${i.imageUrl ? `<img src="${i.imageUrl}" alt="" style="width:100%;height:100%;object-fit:cover;">` : ''}</div>
            <div class="content">
              <div class="meta">
                <span class="badge">${i.category||'general'}</span>
                <span>${timeAgo(i.publishedAt)}</span>
                <span>• ${(i.source||'')}</span>
              </div>
              <h3>${i.titleFa || i.title}</h3>
              <div class="summary">${i.summaryFa || i.summary || ''}</div>
              <a class="link" href="${i.url}" target="_blank" rel="noopener">مشاهده در منبع</a>
            </div>
          </article>
        `).join('');

        $empty.style.display = list.length ? 'none' : 'block';

        const latest = items.slice().sort((a,b)=> new Date(b.publishedAt)-new Date(a.publishedAt)).slice(0,10);
        const line = latest.map(i=>`<span class="tick">• <a href="${i.url}" target="_blank" rel="noopener">${i.titleFa || i.title}</a></span>`).join('');
        $tickerA.innerHTML = line; $tickerB.innerHTML = line;

        [...$grid.querySelectorAll('.card')].forEach(card=>{
          card.addEventListener('click', (e)=>{
            if (e.target.closest('a')) return;
            const id = card.getAttribute('data-id');
            const item = items.find(x=>x.id===id);
            if(item) openModal(item);
          });
        });
      }

      async function load(){
        try{
          const res = await fetch('articles.json', { cache:'no-store' });
          const data = await res.json();
          window.__ARTICLES__ = data;
          render(data);
        }catch(e){
          $grid.innerHTML = '<div class="empty">خطا در بارگذاری خبرها</div>';
        }
      }

      $filters.addEventListener('click', (e)=>{
        const b = e.target.closest('.chip[data-cat]'); if(!b) return;
        [...$filters.querySelectorAll('.chip[data-cat]')].forEach(x=>x.classList.remove('active'));
        b.classList.add('active'); render(window.__ARTICLES__||[]);
      });
      $search.addEventListener('input', ()=> render(window.__ARTICLES__||[]) );
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });

      load();
      $btn?.addEventListener('click', load);
    </script>
  </body>
</html>
