---
const siteTitle = "Ù‡ÙˆØ´ÛŒÙ†Ùˆ â€” Ø§ÙˆÙ„ÛŒÙ† Ù¾Ø§ÛŒÚ¯Ø§Ù‡ Ø®Ø¨Ø±ÛŒ Ù…Ø¨ØªÙ†ÛŒ Ø¨Ø± Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ";
---
<!DOCTYPE html>
<html lang="fa" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>{siteTitle}</title>
    <meta name="description" content="{siteTitle} | Ú¯Ø±Ø¯Ø¢ÙˆØ±ÛŒØŒ ØªØ±Ø¬Ù…Ù‡ Ùˆ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø®Ø¨Ø±Ù‡Ø§ Ø§Ø² Ù…Ù†Ø§Ø¨Ø¹ Ù…Ø¹ØªØ¨Ø± Ø®Ø§Ø±Ø¬ÛŒ.">
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header>
      <div class="container">
        <div class="top">
          <div class="brand">
            <div class="logo">ğŸ§ </div>
            <div>
              <h1>{siteTitle}</h1>
              <p class="sub">Ú¯Ø±Ø¯Ø¢ÙˆØ±ÛŒØŒ ØªØ±Ø¬Ù…Ù‡ Ùˆ Ø¯Ø³ØªÙ‡â€ŒØ¨Ù†Ø¯ÛŒ Ø®ÙˆØ¯Ú©Ø§Ø± Ø®Ø¨Ø±Ù‡Ø§ Ø§Ø² Ù…Ù†Ø§Ø¨Ø¹ Ù…Ø¹ØªØ¨Ø± Ø®Ø§Ø±Ø¬ÛŒ</p>
            </div>
          </div>
          <div class="actions">
            <span class="live"><span class="dot"></span> Ø²Ù†Ø¯Ù‡</span>
          </div>
        </div>
        <div class="row">
          <div class="filters" id="filters">
            <button class="chip active" data-cat="all">Ù‡Ù…Ù‡</button>
            <button class="chip" data-cat="world">Ø¬Ù‡Ø§Ù†</button>
            <button class="chip" data-cat="business">Ø§Ù‚ØªØµØ§Ø¯</button>
            <button class="chip" data-cat="science">Ø¹Ù„Ù…</button>
            <button class="chip" data-cat="tech">ØªÚ©Ù†ÙˆÙ„ÙˆÚ˜ÛŒ</button>
            <button class="chip" id="btn-refresh">Ø¨Ø±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ</button>
          </div>
          <input class="search" id="search" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø± Ø¹Ù†ÙˆØ§Ù†/Ø®Ù„Ø§ØµÙ‡...">
        </div>
      </div>
      <div class="ticker-wrap" aria-label="Ù†ÙˆØ§Ø± ØªÛŒØªØ±Ù‡Ø§ÛŒ Ø²Ù†Ø¯Ù‡">
        <div class="container" style="padding-top:0;padding-bottom:0">
          <div class="ticker">
            <span class="ticker-label">Ø®Ø¨Ø±Ù‡Ø§ÛŒ Ø¬Ø¯ÛŒØ¯</span>
            <div class="ticker-track marqA" id="tickerA"></div>
            <div class="ticker-track marqB" id="tickerB" aria-hidden="true"></div>
          </div>
        </div>
      </div>
    </header>

    <main class="container">
      <div class="grid" id="grid"></div>
      <div id="empty" class="empty" style="display:none;">Ù…ÙˆØ±Ø¯ÛŒ ÛŒØ§ÙØª Ù†Ø´Ø¯.</div>
    </main>

    <div class="modal" id="modal">
      <div class="sheet">
        <div class="sheet-head">
          <strong>Ø®Ù„Ø§ØµÙ‡ Ø®Ø¨Ø±</strong>
          <button class="close" id="btn-close">Ø¨Ø³ØªÙ†</button>
        </div>
        <div class="sheet-body">
          <h3 class="sheet-title" id="m-title"></h3>
          <div class="sheet-meta">
            <span id="m-source"></span>
            <span id="m-time"></span>
            <span id="m-cat"></span>
          </div>
          <p id="m-summary"></p>
          <p style="margin-top:10px"><a id="m-link" href="#" target="_blank" rel="noopener" class="link">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± Ù…Ù†Ø¨Ø¹</a></p>
        </div>
      </div>
    </div>

    <footer style="text-align:center;opacity:.7;padding:24px 0;font-size:12px">Â© {siteTitle}</footer>

    <script type="module">
      const $grid=document.getElementById('grid');
      const $filters=document.getElementById('filters');
      const $search=document.getElementById('search');
      const $empty=document.getElementById('empty');
      const $btn=document.getElementById('btn-refresh');
      const $tickerA=document.getElementById('tickerA');
      const $tickerB=document.getElementById('tickerB');

      const $modal=document.getElementById('modal');
      const $mTitle=document.getElementById('m-title');
      const $mSource=document.getElementById('m-source');
      const $mTime=document.getElementById('m-time');
      const $mCat=document.getElementById('m-cat');
      const $mSummary=document.getElementById('m-summary');
      const $mLink=document.getElementById('m-link');
      const $btnClose=document.getElementById('btn-close');

      function timeAgo(iso){
        const ts=new Date(iso).getTime();
        const diff=Math.floor((Date.now()-ts)/1000);
        if(diff<60)return'Ù‡Ù…ÛŒÙ† Ø§Ù„Ø§Ù†';
        const m=Math.floor(diff/60); if(m<60)return m+' Ø¯Ù‚ÛŒÙ‚Ù‡ Ù¾ÛŒØ´';
        const h=Math.floor(m/60); if(h<24) return h+' Ø³Ø§Ø¹Øª Ù¾ÛŒØ´';
        const d=Math.floor(h/24); return d+' Ø±ÙˆØ² Ù¾ÛŒØ´';
      }

      function openModal(item){
        $mTitle.textContent = item.titleFa || item.title;
        $mSource.textContent = 'Ù…Ù†Ø¨Ø¹: ' + (item.source||'Ù…Ù†Ø¨Ø¹');
        $mTime.textContent = timeAgo(item.publishedAt);
        $mCat.textContent = 'Ø¯Ø³ØªÙ‡: ' + (item.category || 'Ø¹Ù…ÙˆÙ…ÛŒ');
        $mSummary.textContent = item.summaryFa || item.summary || 'â€”';
        $mLink.href = item.url;
        $modal.style.display = 'flex';
      }
      function closeModal(){ $modal.style.display='none'; }
      $btnClose.addEventListener('click', closeModal);
      $modal.addEventListener('click', (e)=>{ if(e.target===$modal) closeModal(); });

      function render(items){
        let list = items.slice();
        const active = $filters.querySelector('.chip[data-cat].active')?.getAttribute('data-cat') || 'all';
        const q = ($search.value||'').trim();
        if (active !== 'all') list = list.filter(i=>i.category===active);
        if (q) list = list.filter(i => (i.titleFa||'').includes(q) || (i.summaryFa||'').includes(q));

        list.sort((a,b)=> new Date(b.publishedAt) - new Date(a.publishedAt));

        $grid.innerHTML = list.map(i => `
          <article class="card" data-id="${i.id}" data-url="${i.url}">
            <div class="thumb">${i.imageUrl ? `<img src="${i.imageUrl}" alt="" style="width:100%;height:100%;object-fit:cover;">` : ''}</div>
            <div class="content">
              <div class="meta">
                <span class="badge">${i.category||'general'}</span>
                <span>${timeAgo(i.publishedAt)}</span>
                <span>â€¢ ${(i.source||'')}</span>
              </div>
              <h3>${i.titleFa || i.title}</h3>
              <div class="summary">${i.summaryFa || i.summary || ''}</div>
              <a class="link" href="${i.url}" target="_blank" rel="noopener">Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ø¯Ø± Ù…Ù†Ø¨Ø¹</a>
            </div>
          </article>
        `).join('');

        $empty.style.display = list.length ? 'none' : 'block';

        const latest = items.slice().sort((a,b)=> new Date(b.publishedAt)-new Date(a.publishedAt)).slice(0,10);
        const line = latest.map(i=>`<span class="tick">â€¢ <a href="${i.url}" target="_blank" rel="noopener">${i.titleFa || i.title}</a></span>`).join('');
        $tickerA.innerHTML = line; $tickerB.innerHTML = line;

        [...$grid.querySelectorAll('.card')].forEach(card=>{
          card.addEventListener('click', (e)=>{
            if (e.target.closest('a')) return;
            const id = card.getAttribute('data-id');
            const item = items.find(x=>x.id===id);
            if(item) openModal(item);
          });
        });
      }

      async function load(){
        try{
          const res = await fetch('articles.json', { cache:'no-store' });
          const data = await res.json();
          window.__ARTICLES__ = data;
          render(data);
        }catch(e){
          $grid.innerHTML = '<div class="empty">Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø®Ø¨Ø±Ù‡Ø§</div>';
        }
      }

      $filters.addEventListener('click', (e)=>{
        const b = e.target.closest('.chip[data-cat]'); if(!b) return;
        [...$filters.querySelectorAll('.chip[data-cat]')].forEach(x=>x.classList.remove('active'));
        b.classList.add('active'); render(window.__ARTICLES__||[]);
      });
      $search.addEventListener('input', ()=> render(window.__ARTICLES__||[]) );
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeModal(); });

      load();
      $btn?.addEventListener('click', load);
    </script>
  </body>
</html>
